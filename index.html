<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Ihsan Project: Ummah Excellence - Metaphysical Modeling Edition</title>

  <link rel="manifest" href="/manifest.json">

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />

  <style>
    body { font-family: 'Inter', sans-serif; }
    .section { padding-top: 6rem; padding-bottom: 6rem; }

    /* New Advanced Color Palette: Sapphire Blue (Primary) and Gold (Accent) */
    .bg-primary { background-color: #1e3a8a; } /* Blue 800 (Deep Sapphire) */
    .bg-primary-dark { background-color: #1e40af; } /* Blue 700 */
    .text-primary { color: #1e3a8a; }
    .border-primary { border-color: #1e3a8a; }
    .bg-accent { background-color: #d97706; } /* Amber 700 (Deep Gold/Ochre) */
    .text-accent { color: #d97706; }
    
    /* Dynamic Geometric Divider with Sapphire/Gold */
    .geometric-divider { 
        height: 8px; 
        background: repeating-linear-gradient(45deg, #1e3a8a, #1e3a8a 15px, #d97706 15px, #d97706 30px); 
        border-radius: 9999px; 
        margin: 6rem auto; 
        width: 90%; 
        max-width: 1000px; 
        opacity: 0.9; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .utility-bar { top: 1.5rem; right: 1.5rem; }
    
    /* Advanced Hover Effects */
    .btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .btn:hover { transform: translateY(-2px) scale(1.01); box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); }

    /* Dark mode adjustments */
    .dark .bg-gray-50 { background-color: #0f172a; } 
    .dark .bg-white { background-color: #1f2937; }
    .dark .text-gray-800 { color: #f3f4f6; }

    /* Input focus (Sapphire glow) */
    input:focus, textarea:focus, select:focus { outline: none; box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.4); border-color: #1e3a8a; }
    
    /* Spinner style for dynamic loading */
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1e3a8a; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: none; margin: 0 auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased transition-colors duration-500">

  <div class="fixed utility-bar z-50 flex flex-col space-y-3">
      <button id="storageToggle" class="bg-blue-500 text-white p-3 rounded-full shadow-xl hover:bg-blue-600 btn transition-transform duration-300" aria-label="Toggle Offline Storage">üíæ</button>
      <button id="darkToggle" class="bg-primary text-white p-3 rounded-full shadow-xl hover:bg-primary-dark btn transition-transform duration-300" aria-label="Toggle Dark Mode">üåô</button>
  </div>

  <a href="#home" class="fixed bottom-6 left-6 z-50 bg-gray-800 text-white p-3 rounded-full shadow-xl hover:bg-gray-700 btn transition-transform duration-300" aria-label="Back to Top">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" /></svg>
  </a>

  <header class="bg-white dark:bg-gray-900 shadow-xl sticky top-0 left-0 w-full z-40 transition-colors duration-500">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <a href="#home" class="flex items-center space-x-3 group" aria-label="Ihsan Project Home">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#1e3a8a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:rotate-12 transition-transform duration-300">
          <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
          <polyline points="2 17 12 22 22 17"></polyline>
          <polyline points="2 12 12 17 22 12"></polyline>
        </svg>
        <h1 class="text-2xl font-black text-primary dark:text-blue-400">Ihsan Project <span class="text-sm font-normal text-gray-500 dark:text-gray-400">Guiding the Ummah to Excellence</span></h1>
      </a>
      <nav class="hidden md:flex space-x-6 font-medium">
        <a href="#home" class="hover:text-primary dark:hover:text-blue-400 btn">Home</a>
        <a href="#typology" class="hover:text-primary dark:hover:text-blue-400 btn">Modeling</a>
        <a href="#muhasaba" class="hover:text-primary dark:hover:text-blue-400 btn">Mu·∏•ƒÅÃÅsaba</a>
        <a href="#tazkiyah" class="hover:text-primary dark:hover:text-blue-400 btn">Tazkiyah</a>
        <a href="#contact" class="hover:text-primary dark:hover:text-blue-400 btn">Contact</a>
      </nav>
      </div>
  </header>

  <section id="home" class="section pt-32 pb-24 px-4 text-center bg-gradient-to-br from-primary to-primary-dark dark:from-gray-900 dark:to-gray-950 text-white shadow-2xl" data-aos="fade-in-down">
    <h2 class="text-5xl md:text-6xl font-extrabold mb-4 drop-shadow-lg">Ihsan: The Pinnacle of Spiritual Excellence</h2>
    <p class="text-xl md:text-2xl max-w-3xl mx-auto opacity-95 mb-10">This project illuminates the path to sincere, God-conscious moral perfection in every endeavor, for the benefit of all humanity.</p>
    <a href="#muhasaba" class="bg-accent text-primary py-3 px-10 rounded-full font-bold text-lg shadow-2xl hover:bg-amber-600 btn">Start Your Self-Assessment Today</a>
  </section>
  <div class="geometric-divider"></div>

  <section id="typology" class="section max-w-6xl mx-auto px-6" data-aos="fade-up">
    <span class="text-sm font-semibold text-center block text-primary uppercase">Conceptual 3D Mapping</span>
    <h3 class="text-4xl font-bold text-center mb-10">Metaphysical Coordinate System: Mapping the Deen (I-I-I Model) üåå</h3>
    <p class="text-lg max-w-4xl mx-auto text-center mb-8 dark:text-gray-300">We model the three stations of religion (**Islam, Iman, Ihsan**) as a 3D coordinate system, where the optimal position is the furthest point along the **Ihsan axis (Z-axis)**. This visualization helps track spiritual trajectory. 

[Image of X]
: The Cartesian coordinate system, which consists of a vertical y-axis and a horizontal x-axis, is shown here as an example. This coordinate system is made up of these two axes, which cross at the point of origin.</p>

    <div class="grid md:grid-cols-3 gap-6 mb-8 text-center bg-gray-100 dark:bg-gray-900 p-6 rounded-xl shadow-inner" data-aos="zoom-in">
        <div>
            <h4 class="text-2xl font-bold text-blue-600 mb-1">X-Axis: Islam</h4>
            <p class="text-sm dark:text-gray-400">Outward Actions (Compliance)</p>
        </div>
        <div>
            <h4 class="text-2xl font-bold text-amber-600 mb-1">Y-Axis: Iman</h4>
            <p class="text-sm dark:text-gray-400">Inward Belief (Conviction)</p>
        </div>
        <div>
            <h4 class="text-2xl font-bold text-teal-600 mb-1">Z-Axis: Ihsan</h4>
            <p class="text-sm dark:text-gray-400">Qualitative Excellence (Consciousness)</p>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl">
        <h4 class="text-xl font-bold mb-3 text-primary">Calculate Your Conceptual Position P(x, y, z)</h4>
        <div class="grid md:grid-cols-3 gap-4 mb-4">
            <input type="number" id="x-islam" min="0" max="100" value="80" placeholder="X (Islam 0-100)" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" aria-label="Islam Score" />
            <input type="number" id="y-iman" min="0" max="100" value="95" placeholder="Y (Iman 0-100)" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" aria-label="Iman Score" />
            <input type="number" id="z-ihsan" min="0" max="100" value="60" placeholder="Z (Ihsan 0-100)" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" aria-label="Ihsan Score" />
        </div>
        <button id="calculate-position-btn" class="w-full bg-accent text-white py-2 rounded-lg font-bold hover:bg-amber-600 btn text-sm mb-3">Plot Spiritual Vector (Calculate Magnitude)</button>
        <div id="vector-output" class="p-3 bg-gray-50 dark:bg-gray-700 rounded text-gray-700 dark:text-gray-300">
            <p class="font-bold text-lg mb-1">Current Position $\vec{P}$: <span id="coordinates-display">P(80, 95, 60)</span></p>
            <p class="text-sm">Spiritual Vector Magnitude $|\vec{P}|$: <span id="magnitude-display" class="font-semibold">Calculating...</span></p>
            <p class="text-sm text-primary font-semibold mt-1">Goal: Maximize Z and Vector Magnitude. Ihsan requires high values on all three axes.</p>
        </div>
    </div>
  </section>

  <div class="geometric-divider"></div>
  
  <section id="muhasaba" class="section max-w-6xl mx-auto px-6 bg-yellow-50 dark:bg-gray-800/50" data-aos="fade-up">
    <span class="text-sm font-semibold text-accent uppercase block text-center">Algorithmic Spiritual Refinement</span>
    <h3 class="text-4xl font-bold text-center mb-10">The IkhlƒÅ·π£ & IstiqƒÅmah Analytics Dashboard ü§ñ</h3>
    <p class="text-lg max-w-4xl mx-auto text-center mb-12 dark:text-gray-300">This module applies advanced conceptual models to provide non-judgmental, data-driven feedback on your spiritual consistency and sincerity, vital for achieving true **Ihsan**.</p>

    <div class="grid md:grid-cols-2 gap-8">
      
      <div class="bg-white dark:bg-gray-900 p-6 rounded-xl shadow-xl border-t-4 border-primary" data-aos="flip-up" data-aos-delay="100">
        <h4 class="text-xl font-bold mb-3 text-primary flex items-center">Intention & Steadfastness Analysis (TCI/RiyƒÅ) üìà</h4>
        
        <p class="text-sm dark:text-gray-300 mb-2 font-semibold">Self-Reflective Journal Entry (Raw Data Input):</p>
        <textarea id="reflection-input" rows="4" class="w-full p-2 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Describe a significant good deed or trial today. (e.g., 'I performed Fajr on time but felt distracted. I helped an elderly person and they praised me a lot.')"></textarea>
        
        <button id="submit-reflection" class="w-full bg-primary text-white py-2 rounded-lg font-bold hover:bg-primary-dark btn text-sm mt-3">Run Proprietary IkhlƒÅ·π£ Scan</button>
        
        <div id="analysis-output" class="text-sm mt-4 p-3 bg-gray-100 dark:bg-gray-700 rounded text-gray-700 dark:text-gray-300 hidden">
            <h5 class="font-bold text-lg mb-1">Algorithmic Feedback:</h5>
            <div class="spinner mb-2" id="analysis-spinner"></div>
            
            <p class="font-semibold text-primary">Temporal Consistency Index (TCI): <span id="tci-score" class="text-base font-normal">N/A</span></p>
            <p class="text-xs italic mb-2">*(Measures IstiqƒÅmah against your 7-day average performance baseline.)*</p>
            
            <p class="font-semibold text-accent">RiyƒÅ Heuristic Flag: <span id="riya-flag" class="text-base font-normal">N/A</span></p>
            <p class="text-xs italic">*(Conceptual NLP scan for linguistic cues indicating potential self-deception or desire for social validation.)*</p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-900 p-6 rounded-xl shadow-xl border-t-4 border-accent" data-aos="flip-up" data-aos-delay="300">
        <h4 class="text-xl font-bold mb-4 text-accent flex items-center">Priority & Social Justice Metrics (Fiqh al-AwlƒÅwiyƒÅt) ‚öñÔ∏è</h4>
        
        <div class="space-y-4">
            <label class="block dark:text-gray-300 border-b pb-3 border-gray-200 dark:border-gray-700">
                <span class="font-semibold text-sm block mb-1">Fard (Obligatory) Assessment:</span>
                <select id="fard-status" class="w-full p-2 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="perfect">Perfect (All duties fulfilled with ItqƒÅn)</option>
                    <option value="adequate">Adequate (Met minimum Fard duties)</option>
                    <option value="lacking">Lacking (Missed/delayed Fard duties)</option>
                </select>
            </label>
            
            <label class="block dark:text-gray-300">
                <span class="font-semibold text-sm block mb-1">Haqq al-'IbƒÅd (Rights of People) Input:</span>
                <div class="flex space-x-2 mb-2">
                    <input type="number" id="social-justice-score" min="0" max="100" value="75" class="w-full p-2 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Score 0-100">
                </div>
                <p class="text-xs italic dark:text-gray-400">**(0: Actively harmed/oppressed; 100: Maximized Manfa'a/Justice)**</p>
            </label>
            
            <div class="mt-4 p-3 bg-accent/10 dark:bg-gray-700/50 rounded-lg">
                <p id="focus-recommendation" class="text-base font-bold text-gray-800 dark:text-gray-200">Recommendation: Loading...</p>
                <p class="text-sm mt-1 font-semibold text-accent">Haqq al-'IbƒÅd Score: <span id="haqq-score-display">75/100</span></p>
            </div>
        </div>
      </div>
      
    </div>
  </section>

  <div class="geometric-divider"></div>

  <section id="tazkiyah" class="section max-w-6xl mx-auto px-6 bg-gray-50 dark:bg-gray-900" data-aos="fade-up">
    <span class="text-sm font-semibold text-center block text-teal-600 uppercase">Adaptive Spiritual Purification</span>
    <h3 class="text-4xl font-bold text-center mb-10">Tazkiyah Module: Algorithmic Repentance & Sins Decay Model üíß</h3>
    <p class="text-lg max-w-4xl mx-auto text-center mb-12 dark:text-gray-300">This module helps track the process of **Tazkiyah (purification)** by modeling the Islamic principles of repentance (**Tawbah**) and the expiation of sins (**Sayyi'ƒÅt** by **HasanƒÅt**), providing a conceptual decay rate for recorded missteps.</p>

    <div class="grid md:grid-cols-2 gap-8">
      
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl border-t-4 border-teal-500" data-aos="fade-right" data-aos-delay="100">
        <h4 class="text-xl font-bold mb-3 text-teal-600">Repentance Fulfillment Score (Tawbah)</h4>
        <p class="text-sm dark:text-gray-300 mb-4">The Prophet (PBUH) defined repentance by three steps: regret, cessation, and resolution not to repeat. Rate your repentance completion:</p>
        
        <label class="block mb-2 dark:text-gray-300">
            <span class="font-semibold text-sm">Severity of Sin (0: Minor to 10: Major):</span>
            <input type="number" id="sin-severity" min="0" max="10" value="5" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
        </label>
        
        <div class="space-y-2 mb-4">
            <label class="flex items-center space-x-2 dark:text-gray-300">
                <input type="checkbox" class="form-checkbox text-teal-500 w-5 h-5" id="regret-check">
                <span>**Nadm (Regret):** Deeply regretted the action.</span>
            </label>
            <label class="flex items-center space-x-2 dark:text-gray-300">
                <input type="checkbox" class="form-checkbox text-teal-500 w-5 h-5" id="cessation-check">
                <span>**IqlƒÅ' (Cessation):** Stopped the act immediately.</span>
            </label>
            <label class="flex items-center space-x-2 dark:text-gray-300">
                <input type="checkbox" class="form-checkbox text-teal-500 w-5 h-5" id="resolution-check">
                <span>**'Azm (Resolution):** Firm resolve not to return to it.</span>
            </label>
        </div>
        
        <button id="calculate-tawbah-btn" class="w-full bg-teal-600 text-white py-2 rounded-lg font-bold hover:bg-teal-700 btn text-sm">Calculate Tawbah Completion</button>
        <div id="tawbah-output" class="mt-3 p-3 bg-teal-50 dark:bg-gray-700/50 rounded text-gray-700 dark:text-gray-300 text-center">
            <p class="font-bold">Tawbah Completion Status: <span id="tawbah-status">0%</span></p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl border-t-4 border-primary" data-aos="fade-left" data-aos-delay="300">
        <h4 class="text-xl font-bold mb-3 text-primary">Conceptual Sins Decay Model (HasanƒÅt Expiation) üìâ</h4>
        <p class="text-sm dark:text-gray-300 mb-4">Conceptual decay modeling based on the Qur'anic principle: *Indeed, good deeds erase bad deeds* (Qur'an 11:114). The higher your Mu·∏•ƒÅÃÅsaba score, the faster the decay.</p>

        <label class="block mb-2 dark:text-gray-300">
            <span class="font-semibold text-sm">Estimated Sins Magnitude (Initial):</span>
            <input type="number" id="sins-magnitude" value="1000" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
        </label>
        <label class="block mb-4 dark:text-gray-300">
            <span class="font-semibold text-sm">Current Ihsan/Mu·∏•ƒÅÃÅsaba Score (Expiation Rate):</span>
            <input type="number" id="ihsan-rate" value="95" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
        </label>

        <button id="calculate-decay-btn" class="w-full bg-primary text-white py-2 rounded-lg font-bold hover:bg-primary-dark btn text-sm">Simulate 7-Day Decay</button>
        <div id="decay-output" class="mt-3 p-3 bg-primary/10 dark:bg-gray-700/50 rounded text-gray-700 dark:text-gray-300 text-center">
            <p class="font-bold">Initial Magnitude: <span id="initial-mag">1000</span> Units</p>
            <p class="font-bold">Magnitude after 7 Days: <span id="final-mag" class="text-xl text-primary">...</span> Units</p>
            <p class="text-xs italic mt-1">*(Higher Ihsan Score = Higher Expiation Rate)*</p>
        </div>
      </div>
    </div>
  </section>

  <div class="geometric-divider"></div>

  <section id="contact" class="section max-w-5xl mx-auto px-6" data-aos="fade-up">
    <span class="text-sm font-semibold text-center block text-primary uppercase">Engagement Portal</span>
    <h3 class="text-4xl font-bold text-center mb-10">Direct Contact: The Ihsan Project Team üìû</h3>
    <p class="text-center text-lg max-w-3xl mx-auto mb-8 dark:text-gray-300">For academic collaborations, research queries, or advanced ethical consultation, please use the portal below. We strive for Ihsan in our communication response time, guided by esteemed scholars.</p>
    <form class="space-y-6 bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl" id="contact-form" aria-labelledby="contact-heading">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label for="name" class="block text-sm font-medium mb-1">Name</label>
          <input type="text" id="name" name="name" required class="w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Your Name" aria-required="true" />
        </div>
        <div>
          <label for="email" class="block text-sm font-medium mb-1">Email</label>
          <input type="email" id="email" name="email" required class="w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Your Email" aria-required="true" />
        </div>
      </div>
      <div>
        <label for="subject" class="block text-sm font-medium mb-1">Subject</label>
        <input type="text" id="subject" name="subject" required class="w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Advanced Query Type" aria-required="true" />
      </div>
      <div>
        <label for="message" class="block text-sm font-medium mb-1">Detailed Message</label>
        <textarea id="message" name="message" rows="5" required class="w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Your detailed request here..." aria-required="true"></textarea>
      </div>
      <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-bold hover:bg-primary-dark btn shadow-md" id="submit-contact">Submit Advanced Query</button>
      <div id="contact-status" class="mt-3 text-center text-sm font-semibold hidden" aria-live="assertive"></div>
    </form>
  </section>
  <footer class="bg-gray-800 dark:bg-gray-900 text-white text-center py-8 mt-16 transition-colors duration-500">
    <div class="max-w-7xl mx-auto px-6">
      <p class="text-sm border-t border-gray-700 pt-4">&copy; 2025 Ihsan Project. Developed by **The Ihsan Project Team**. PWA Ready. Metaphysical Modeling v3.0.</p>
    </div>
  </footer>


  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    // 1. AOS animations Initialization
    AOS.init({ 
      duration: 1000, 
      once: true,
      easing: 'ease-in-out'
    });

    // 2. Dark mode toggle and persistence (Omitted for brevity)
    const darkToggle = document.getElementById('darkToggle');
    const htmlEl = document.documentElement;

    function setTheme(theme) {
      if (theme === 'dark') {
        htmlEl.classList.add('dark');
        localStorage.theme = 'dark';
        darkToggle.textContent = '‚òÄÔ∏è';
      } else {
        htmlEl.classList.remove('dark');
        localStorage.theme = 'light';
        darkToggle.textContent = 'üåô';
      }
    }

    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      setTheme('dark');
    } else {
      setTheme('light');
    }

    darkToggle.addEventListener('click', () => {
      const newTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
      setTheme(newTheme);
    });
    
    
    // --- ADVANCED FEATURE IMPLEMENTATION ---

    // Conceptual historical data for TCI (last 7 days' score - max 100)
    const historicalScores = [75, 80, 78, 85, 82, 88, 91]; 
    const tciScore = document.getElementById('tci-score');
    const riyaFlag = document.getElementById('riya-flag');
    const fardStatus = document.getElementById('fard-status');
    const focusRecommendation = document.getElementById('focus-recommendation');
    const socialJusticeScoreInput = document.getElementById('social-justice-score');
    const haqqScoreDisplay = document.getElementById('haqq-score-display');
    
    // 3. METAPHYSICAL MODELING (3D Vector Calculation)
    const xIslam = document.getElementById('x-islam');
    const yIman = document.getElementById('y-iman');
    const zIhsan = document.getElementById('z-ihsan');
    const calculatePositionBtn = document.getElementById('calculate-position-btn');
    const coordinatesDisplay = document.getElementById('coordinates-display');
    const magnitudeDisplay = document.getElementById('magnitude-display');

    calculatePositionBtn.addEventListener('click', () => {
        const x = parseFloat(xIslam.value) || 0;
        const y = parseFloat(yIman.value) || 0;
        const z = parseFloat(zIhsan.value) || 0;

        // Display Coordinates
        coordinatesDisplay.textContent = `P(${x.toFixed(0)}, ${y.toFixed(0)}, ${z.toFixed(0)})`;

        // Calculate Magnitude: |P| = sqrt(x^2 + y^2 + z^2)
        // This mathematically models spiritual trajectory in 3D space.
        const magnitude = Math.sqrt(x * x + y * y + z * z);
        magnitudeDisplay.textContent = `${magnitude.toFixed(2)} Units`;
    });

    // 4. FARD/NAWƒÄFIL Dynamic Prioritizer & Haqq al-'IbƒÅd Score Logic (Omitted for brevity)
    function updateMu·∏•ƒÅÃÅsabaMetrics() {
        // ... (Existing logic for Fard/Haqq Score)
        const status = fardStatus.value;
        const haqqScore = parseInt(socialJusticeScoreInput.value);

        haqqScoreDisplay.textContent = `${haqqScore}/100`;

        focusRecommendation.classList.remove('text-primary', 'text-accent', 'text-red-500', 'text-gray-800');

        if (status === 'lacking') {
            focusRecommendation.textContent = "CRITICAL: Fard duties are lacking. Focus entirely on perfecting the Obligatory Acts. Voluntary acts (NawƒÅfil) are secondary. (Hadith Qudsi)";
            focusRecommendation.classList.add('text-red-500');
        } else if (haqqScore < 50) {
             focusRecommendation.textContent = `CRITICAL: Haqq al-'IbƒÅd score is low (${haqqScore}). Prioritize making amends and maximizing Manfa'a (Benefit to creation). Social Ihsan is mandatory.`;
             focusRecommendation.classList.add('text-red-500');
        } else if (status === 'perfect' && haqqScore >= 90) {
            focusRecommendation.textContent = "EXCELLENCE (Ihsan State): Fard is perfect, and Huq≈´q al-IbƒÅd is maximized. Maintain this comprehensive spiritual altitude (IstiqƒÅmah).";
            focusRecommendation.classList.add('text-primary');
        } else if (status === 'perfect' && haqqScore >= 70) {
             focusRecommendation.textContent = "STRONG: Fard is perfect. Huq≈´q al-IbƒÅd is commendable. Seek subtle ways to enhance benefit to your community (Manfa'a).";
            focusRecommendation.classList.add('text-accent');
        } else {
            focusRecommendation.textContent = "Recommendation: Ensure Fard is perfect (ItqƒÅn). Then, review the Haqq al-'IbƒÅd score for potential social improvement areas.";
            focusRecommendation.classList.add('text-gray-800', 'dark:text-gray-200');
        }
    }

    if (fardStatus && socialJusticeScoreInput) {
        fardStatus.addEventListener('change', updateMu·∏•ƒÅÃÅsabaMetrics);
        socialJusticeScoreInput.addEventListener('input', updateMu·∏•ƒÅÃÅsabaMetrics);
        updateMu·∏•ƒÅÃÅsabaMetrics(); // Initial run
    }


    // 5. TCI & RiyƒÅ Heuristic Engine Logic (Omitted for brevity)
    const submitReflection = document.getElementById('submit-reflection');
    const reflectionInput = document.getElementById('reflection-input');
    const analysisOutput = document.getElementById('analysis-output');
    const analysisSpinner = document.getElementById('analysis-spinner');

    submitReflection.addEventListener('click', () => {
        const reflection = reflectionInput.value.trim().toLowerCase();
        if (reflection.length < 30) {
            alert("Please write a detailed reflection (min. 30 characters) for a meaningful scan.");
            return;
        }

        // 1. Show loading state
        submitReflection.disabled = true;
        analysisOutput.classList.remove('hidden');
        tciScore.textContent = 'Analyzing...';
        riyaFlag.textContent = 'Scanning...';
        analysisSpinner.style.display = 'block';

        // 2. Simulate API Call & Advanced Heuristic Processing
        setTimeout(() => {
            analysisSpinner.style.display = 'none';
            submitReflection.disabled = false;
            
            // TCI Calculation (Temporal Consistency Index)
            const currentScore = Math.floor(Math.random() * 5) + 95; 
            const averageScore = historicalScores.reduce((a, b) => a + b, 0) / historicalScores.length;
            const deviation = currentScore - averageScore;
            
            let tciResult;
            if (deviation >= 5) {
                tciResult = `${currentScore} (Top 10th Percentile). **Significant Uplift** in IstiqƒÅmah detected. Well done!`;
            } else if (deviation < -5) {
                tciResult = `${currentScore} (Below Average). **Consistency Deviation** detected. Review yesterday's log for root cause analysis.`;
            } else {
                tciResult = `${currentScore} (Stable). **IstiqƒÅmah Maintained**. Steadfastness is loved by Allah.`;
            }

            // RiyƒÅ Heuristic Engine (IkhlƒÅ·π£ Check)
            let riyaResult = "IkhlƒÅ·π£ Confirmed (None Detected).";
            const riyaKeywords = ['proud', 'told everyone', 'boast', 'people saw', 'praised me', 'i deserve'];

            if (riyaKeywords.some(keyword => reflection.includes(keyword)) && reflection.includes('generously')) {
                riyaResult = "POTENTIAL HIGH FLAG. Contains self-praise and mention of public knowledge. Re-evaluate Niyyah (intention) to safeguard IkhlƒÅ·π£.";
            } else if (reflection.includes('distracted') && reflection.includes('forgive')) {
                 riyaResult = "Sincerity is validated by admitting internal faults (distraction) while focusing on external virtue (forgiveness). Good IkhlƒÅ·π£.";
            }

            // 3. Display Result
            tciScore.textContent = tciResult;
            riyaFlag.textContent = riyaResult;
            
            historicalScores.shift();
            historicalScores.push(currentScore);

        }, 3000); 
    });

    // 6. TAZKIYAH MODULE: Algorithmic Repentance Tracker (Tawbah)
    const regretCheck = document.getElementById('regret-check');
    const cessationCheck = document.getElementById('cessation-check');
    const resolutionCheck = document.getElementById('resolution-check');
    const sinSeverity = document.getElementById('sin-severity');
    const tawbahStatus = document.getElementById('tawbah-status');
    const calculateTawbahBtn = document.getElementById('calculate-tawbah-btn');

    calculateTawbahBtn.addEventListener('click', () => {
        let score = 0;
        if (regretCheck.checked) score += 33.33;
        if (cessationCheck.checked) score += 33.33;
        if (resolutionCheck.checked) score += 33.34;
        
        const severity = parseInt(sinSeverity.value);
        let statusText;

        if (score >= 99) {
            statusText = `**100%** - Complete Tawbah. Seek forgiveness from the offended party if the sin involved Huq≈´q al-IbƒÅd.`;
        } else if (severity >= 8 && score < 99) {
            statusText = `${score.toFixed(0)}% - Incomplete. High severity sin requires immediate completion of all three stages for valid Tawbah.`;
        } else {
            statusText = `${score.toFixed(0)}% - Incomplete. Continue striving to fulfill the remaining conditions (Nadm, IqlƒÅ', 'Azm).`;
        }
        tawbahStatus.innerHTML = statusText;
    });

    // 7. TAZKIYAH MODULE: Temporal Sins Decay Heuristic
    const sinsMagnitudeInput = document.getElementById('sins-magnitude');
    const ihsanRateInput = document.getElementById('ihsan-rate');
    const initialMagDisplay = document.getElementById('initial-mag');
    const finalMagDisplay = document.getElementById('final-mag');
    const calculateDecayBtn = document.getElementById('calculate-decay-btn');

    calculateDecayBtn.addEventListener('click', () => {
        let initialMagnitude = parseFloat(sinsMagnitudeInput.value);
        const ihsanRate = parseFloat(ihsanRateInput.value);
        
        // Ensure inputs are valid
        if (isNaN(initialMagnitude) || isNaN(ihsanRate) || initialMagnitude < 0 || ihsanRate < 0 || ihsanRate > 100) {
            finalMagDisplay.textContent = "Error: Invalid Input";
            return;
        }

        // --- Decay Model (Conceptual Exponential Decay) ---
        // Decay Factor (k): k = (Ihsan_Rate / 100)^2 / 100. Higher rate means faster decay.
        // We square the Ihsan Rate to emphasize the non-linear benefit of Ihsan.
        const decayFactor = Math.pow(ihsanRate / 100, 2) / 20; 
        
        // Formula for sins decay over 7 periods (days): 
        // Magnitude_Final = Magnitude_Initial * e^(-k * t)
        const finalMagnitude = initialMagnitude * Math.pow(Math.E, (-decayFactor * 7));
        
        initialMagDisplay.textContent = initialMagnitude.toFixed(0);
        finalMagDisplay.textContent = finalMagnitude.toFixed(2);
        
        if (finalMagnitude < initialMagnitude / 2) {
            finalMagDisplay.classList.add('text-green-500');
            finalMagDisplay.classList.remove('text-primary');
        } else {
            finalMagDisplay.classList.add('text-primary');
            finalMagDisplay.classList.remove('text-green-500');
        }
    });

  </script>
</body>
</html>
